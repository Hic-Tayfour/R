---
title: |
  <div style="text-align: center; margin-top: 30px;">
    <h1 style="font-size: 24px;"><strong>INSPER ‚Äì INSTITUTO DE ENSINO E PESQUISA</strong></h1>
    <h2 style="font-style: italic; font-size: 20px;">Curso de Economia</h2>
    <div style="margin-top: 30px;"></div>
    <h3 style="font-size: 20px;">Problemas em Economia</h3>
    <p style="font-size: 18px;"><strong>Tema:</strong> A Rela√ß√£o entre a Independ√™ncia do Banco Central e a Pot√™ncia da Pol√≠tica Monet√°ria</p>
  </div>

subtitle: |
  <div style="text-align: center; margin-top: 30px;">
    <p style="font-size: 16px;"><strong>Professores:</strong></p>
    <p style="font-size: 15px;">Juliana Inhasz<br>
    S√©rgio Ricardo Martins<br>
    Paulo Jose Mencacci Costa (Prof. Auxiliar)</p>
  </div>

author: |
  <div style="text-align: center; margin-top: 30px;">
    <p style="font-size: 16px;"><strong>Integrantes:</strong></p>
    <p style="font-size: 14px;">
      Caio Santa Rosa Christovam ‚Äì <a href="mailto:caiosrc@al.insper.edu.br">caiosrc@al.insper.edu.br</a><br>
      √ârika Kaori Fuzisaka ‚Äì <a href="mailto:erikakf1@al.insper.edu.br">erikakf1@al.insper.edu.br</a><br>
      Hicham Munir Tayfour ‚Äì <a href="mailto:hichamt@al.insper.edu.br">hichamt@al.insper.edu.br</a><br>
      Lucas Batista Ferreira ‚Äì <a href="mailto:lucasbf1@al.insper.edu.br">lucasbf1@al.insper.edu.br</a><br>
      Maria Antonia Pereira Guimar√£es ‚Äì <a href="mailto:mariaapg1@al.insper.edu.br">mariaapg1@al.insper.edu.br</a><br>
      Maria Eduarda Marques Pereira ‚Äì <a href="mailto:mariaemp@al.insper.edu.br">mariaemp@al.insper.edu.br</a><br>
      Maria Morais Garcia Leal ‚Äì <a href="mailto:mariamgl@al.insper.edu.br">mariamgl@al.insper.edu.br</a>
    </p>
  </div>

date: |
  <div style="text-align: center; margin-top: 20px;">
    <p><strong>S√£o Paulo ‚Äì Fevereiro de 2025</strong></p>
  </div>

output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: flatly
    highlight: tango
    df_print: paged

fontsize: 12pt
encoding: UTF-8
lang: pt-BR
---

------------------------------------------------------------------------

# Hip√≥tese de Pesquisa

Este estudo busca avaliar empiricamente a seguinte hip√≥tese:

> **Hip√≥tese**: Quanto maior o grau de independ√™ncia do Banco Central, maior ser√° a pot√™ncia da pol√≠tica monet√°ria no controle inflacion√°rio.

Mais especificamente, assume-se que bancos centrais com maior autonomia institucional possuem maior credibilidade e capacidade de ancorar expectativas, o que se reflete em uma resposta mais efetiva da infla√ß√£o √† pol√≠tica monet√°ria.

Para testar essa hip√≥tese, ser√° conduzida uma an√°lise emp√≠rica baseada em dados internacionais, com foco na rela√ß√£o entre:

-   O **grau de independ√™ncia do Banco Central** (medido por um √≠ndice padronizado ou por classifica√ß√£o categ√≥rica), e

-   A **pot√™ncia da pol√≠tica monet√°ria**, avaliada por meio da resposta da infla√ß√£o a varia√ß√µes na taxa de juros real.

Modelos econom√©tricos e an√°lises descritivas complementares ser√£o utilizados para investigar essa rela√ß√£o ao longo do tempo e entre diferentes grupos de pa√≠ses (por regime monet√°rio e institui√ß√µes).

# ‚öôÔ∏è Configura√ß√£o do Ambiente

```{r config}
knitr::opts_chunk$set(fig.width=15, fig.height=10)

```

# üì¶ Carregando Pacotes

```{r setup, message=FALSE, warning=FALSE}

# Manipula√ß√£o e Visualiza√ß√£o de Dados
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(ggtext)
library(patchwork)
library(gridExtra)
library(CGPfunctions)
library(scales)
library(viridis)
library(ggstream)
library(gganimate)

# An√°lise de S√©ries Temporais e Dados Econ√¥micos
library(tidyquant)
library(WDI)
library(imf.data)
library(seasonal)
library(mFilter)
library(zoo)
library(sidrar)

# Modelagem e Econometria
library(plm)
library(broom)

# Geodados e Mapas
library(rnaturalearth)
library(sf)
library(countrycode)

# Leitura e Organiza√ß√£o de Dados
library(readxl)
library(labelled)

# Tabelas Profissionais
library(gt)
library(gtExtras)
library(stargazer)

```

# üìÉ Importando e Ajustando as Bases de Dados

Nesta se√ß√£o, realizamos a importa√ß√£o e integra√ß√£o das principais bases de dados macroecon√¥micos utilizadas no estudo. As informa√ß√µes s√£o obtidas a partir de fontes confi√°veis, como o Banco Mundial (WDI), o FMI (IFS), e arquivos auxiliares em Excel contendo o √≠ndice de independ√™ncia dos Bancos Centrais e expectativas de infla√ß√£o. O objetivo √© construir uma base padronizada, consistente e apropriada para a an√°lise emp√≠rica.

## üì• Download de Indicadores do Banco Mundial

```{r importacao-indicadores, message=FALSE, warning=FALSE}
# Consulta aos indicadores dispon√≠veis no WDI
indicadores <- WDIsearch()

# Lista de agrupamentos macroecon√¥micos para exclus√£o
agrupamentos <- c(
  "Africa Eastern and Southern", "Africa Western and Central", "Arab World",
  "Early-demographic dividend", "East Asia & Pacific", 
  "East Asia & Pacific (excluding high income)",
  "East Asia & Pacific (IDA & IBRD countries)", "Euro area",
  "Europe & Central Asia", "Europe & Central Asia (excluding high income)",
  "Europe & Central Asia (IDA & IBRD countries)", "European Union",
  "Fragile and conflict affected situations", "Heavily indebted poor countries (HIPC)",
  "High income", "IBRD only", "IDA & IBRD total", "IDA blend", "IDA only",
  "IDA total", "Late-demographic dividend", "Latin America & Caribbean",
  "Latin America & Caribbean (excluding high income)",
  "Latin America & the Caribbean (IDA & IBRD countries)",
  "Least developed countries: UN classification", "Low & middle income",
  "Low income", "Lower middle income", "Middle East & North Africa",
  "Middle East & North Africa (excluding high income)",
  "Middle East & North Africa (IDA & IBRD countries)", "Middle income",
  "Not classified", "OECD members", "Other small states", 
  "Pacific island small states", "Post-demographic dividend", 
  "Pre-demographic dividend", "Small states", "South Asia", 
  "South Asia (IDA & IBRD)", "Sub-Saharan Africa", 
  "Sub-Saharan Africa (excluding high income)", 
  "Sub-Saharan Africa (IDA & IBRD countries)", "Upper middle income", "World"
)
```

## üìä Importa√ß√£o e Tratamento das Vari√°veis Econ√¥micas

```{r download-dados, message=FALSE, warning=FALSE}

# PIB real (constante, US$ 2015)
gdp <- WDI("all", "NY.GDP.MKTP.KD", 1960) %>%
  filter(!country %in% agrupamentos) %>%
  select(country, iso2c, iso3c, year, NY.GDP.MKTP.KD) %>%
  rename(pib = NY.GDP.MKTP.KD) %>%
  arrange(country, year)

# Infla√ß√£o (deflator do PIB)
cpi <- WDI(
  country = "all",
  indicator = "FP.CPI.TOTL.ZG",
  start = 1960,
  end = NULL,
  extra = TRUE
) %>%
  filter(!country %in% agrupamentos) %>%
  select(country, iso2c, iso3c, year, FP.CPI.TOTL.ZG) %>%
  rename(inflation = FP.CPI.TOTL.ZG) %>%
  arrange(country, year)


# D√≠vida governamental (% do PIB)
debt <- WDI("all", "GC.DOD.TOTL.GD.ZS", 1960) %>%
  filter(!country %in% agrupamentos) %>%
  select(country, iso2c, iso3c, year, GC.DOD.TOTL.GD.ZS) %>%
  rename(divida = GC.DOD.TOTL.GD.ZS) %>%
  arrange(country, year)

```

## üìÅ Bases Complementares: Independ√™ncia do BC e Expectativas

```{r download-bases-complementares, message=FALSE, warning=FALSE}
# √çndice de independ√™ncia do Banco Central (base CBIE)
cbi <- readxl::read_xlsx("CBIDta.xlsx", sheet = "Data") %>%
  select(country, iso_a3, year, cbie_index) %>%
  mutate(year = as.numeric(year)) %>%
  arrange(country, year) %>%
  rename(iso3c = iso_a3) %>%
  select(country, iso3c, year, cbie_index)

# Expectativas de infla√ß√£o (FMI)
inf_for <- readxl::read_xlsx("InflationForecast(FMI).xlsx") %>%
  select(Country, Code, Year, `Inflation forecast`) %>%
  rename(
    inflation_forecast = `Inflation forecast`,
    country = Country,
    code = Code,
    year = Year
  ) %>%
  mutate(iso3c = countrycode::countrycode(country, "country.name", "iso3c"))
```

## üí∞ Taxa de Juros de Pol√≠tica Monet√°ria (FMI - IFS)

```{r download-juros, message=FALSE, warning=FALSE}

# Importa√ß√£o da base IFS do FMI
ifs <- imf.data::load_datasets("IFS")

# Sele√ß√£o da s√©rie de taxa de juros
data_wide <- ifs$get_series(
  freq         = "A",
  ref_area     = NULL,
  indicator    = "FPOLM_PA",
  start_period = "1960",
  end_period   = "2025"
)

# Transforma√ß√£o da base
rate <- data_wide %>%
  pivot_longer(cols = -TIME_PERIOD, names_to = "col_indicator", values_to = "taxa_juros") %>%
  mutate(
    iso2c = sub("^A\\.(.*?)\\.FPOLM_PA$", "\\1", col_indicator),
    year  = as.numeric(TIME_PERIOD),
    iso2c = case_when(iso2c %in% c("7A", "U2") ~ "EA", TRUE ~ iso2c),
    iso3c = countrycode::countrycode(iso2c, "iso2c", "iso3c"),
    country = countrycode::countrycode(iso2c, "iso2c", "country.name")
  ) %>%
  filter(!is.na(country)) %>%
  select(country, iso2c, iso3c, year, taxa_juros)
```

## Base de dados "Pr√≥pria"

```{r download-proria, message=FALSE, warning=FALSE}

target <- data.frame(
  Pais = c("New Zealand", "Canada", "Chile", "Israel", "United Kingdom", "Sweden",
           "Finland", "Australia", "Spain", "Czech Republic", "Poland", "Brazil",
           "Colombia", "South Africa", "Thailand", "South Korea", "Mexico",
           "Iceland", "Norway", "Hungary", "Peru", "Philippines", "Guatemala",
           "Indonesia", "Romania", "Turkey", "Serbia", "Ghana", "Uruguay",
           "Albania", "Georgia", "Armenia", "Japan", "India", "Russia",
           "Moldova", "Paraguay", "Uganda", "Dominican Republic"),
  AnoAdocao = c(1989, 1991, 1991, 1991, 1992, 1993,
                1993, 1993, 1994, 1997, 1998, 1999,
                1999, 2000, 2000, 2001, 2001,
                2001, 2001, 2001, 2002, 2002, 2005,
                2005, 2005, 2006, 2007, 2007,
                2009, 2009, 2009, 2013, 2015, 2014,
                2010, 2011, 2011, 2012, 2015),
  SegueAtualmente = c("sim", "sim", "sim", "sim", "sim", "sim",
                      "n√£o", "sim", "n√£o", "sim", "sim", "sim",
                      "sim", "sim", "sim", "sim", "sim",
                      "sim", "sim", "sim", "sim", "sim", "sim",
                      "sim", "n√£o", "sim", "sim", "sim",
                      "sim", "sim", "sim", "sim", "sim", "sim",
                      "sim", "sim", "sim", "sim", "sim")
)

acemoglu_classification <- data.frame(
  Pais = c("Argentina", "Australia", "Austria", "Belgium", "Bolivia", "Brazil", "Canada", 
           "Chile", "China", "Colombia", "Costa Rica", "Denmark", "Dominican Republic", 
           "Ecuador", "El Salvador", "Finland", "France", "Germany", "Greece", "Guatemala", 
           "Guyana", "Honduras", "India", "Indonesia", "Ireland", "Israel", "Italy", 
           "Japan", "South Korea","Malaysia", "Mexico", "Mongolia", "Nepal", "Netherlands", 
           "New Zealand", "Nicaragua", "Norway", "Pakistan", "Paraguay", "Peru", 
           "Philippines", "Portugal", "Qatar", "Singapore", "Spain", "Sweden", 
           "Switzerland", "Turkey", "United Kingdom", "United States of America", 
           "Uruguay", "Venezuela"),
  Classe = c("Medium", "High", "High", "Medium", "Medium", "Medium",
             "High", "Medium", "Medium", "Medium", "Medium", "High",
             "Medium", "Low", "Medium", "High", "Medium",
             "High", "Medium", "Low", "Medium", "Low", "Medium",
             "Low", "High", "Medium", "Medium", "Medium", "Medium", "Medium",
             "Medium", "Medium", "Medium", "High", "High", "Low",
             "High", "Low", "Low", "Medium", "Medium", "Medium",
             "Medium", "High", "Medium", "High", "High", "Medium",
             "High", "High", "Medium", "Low")
)
```

# üß© Integra√ß√£o das Bases e Constru√ß√£o da Base Final

```{r integracao-bases, message=FALSE, warning=FALSE}

# Juntando todas as vari√°veis
data <- cbi %>%
  inner_join(cpi  %>% select(-country), by = c("iso3c", "year")) %>%
  inner_join(debt %>% select(-country), by = c("iso3c", "year")) %>%
  inner_join(gdp  %>% select(-country), by = c("iso3c", "year")) %>%
  inner_join(rate %>% select(-country), by = c("iso3c", "year")) %>%
  inner_join(inf_for %>% select(-country), by = c("iso3c", "year")) %>%
  filter(year >= 2000) %>%
  select(-c(iso2c.y, iso2c.x.x, iso2c.y.y)) %>%
  rename(iso2c = iso2c.x) %>%
  group_by(country) %>%
  arrange(year) %>%
  mutate(
    taxa_juros = as.numeric(taxa_juros),
    pib_pot   = mFilter::hpfilter(pib, freq = 6.25)$trend,
    hiato_pct = ((pib - pib_pot) / pib_pot) * 100,
    real_rate = ((1 + taxa_juros) / (1 + inflation)) - 1
  ) %>%
  ungroup() %>%
  arrange(country, year) %>%
  select(
    country, iso3c, iso2c, year,
    pib, inflation, inflation_forecast, taxa_juros,
    cbie_index, divida, pib_pot, hiato_pct, real_rate
  ) %>%
  labelled::set_variable_labels(
    pib                = "GDP (constant 2015 US$)",
    inflation          = "Infla√ß√£o (%)",
    inflation_forecast = "Expectativa de Infla√ß√£o (%)",
    taxa_juros         = "Taxa de juros nominal (%)(BC)",
    cbie_index         = "√çndice de independ√™ncia do Banco Central",
    divida             = "D√≠vida governamental (% do PIB)",
    pib_pot            = "PIB potencial (filtro HP)",
    hiato_pct          = "Hiato do produto (%)",
    real_rate          = "Taxa de juros real (%)"
  ) %>% 
  mutate(across(where(~ inherits(.x, "matrix")), as.numeric))
```

# üîé Visualiza√ß√£o Inicial da Base Final

```{r visao-geral, message=FALSE, warning=FALSE}
# Visualiza√ß√£o da base final
data %>%
  glimpse()
```

# üìà An√°lise Descritiva

## üìä Gr√°fico de Cobertura de Dados

```{r grafico-cobertura, message=FALSE, warning=FALSE}

data %>%
  mutate(across(
    c(
      pib,
      inflation,
      inflation_forecast,
      taxa_juros,
      cbie_index,
      divida,
      pib_pot,
      hiato_pct,
      real_rate
    ),
    ~ as.numeric(.x)
  )) %>%
  select(
    iso3c,
    pib,
    inflation,
    inflation_forecast,
    taxa_juros,
    cbie_index,
    divida,
    pib_pot,
    hiato_pct,
    real_rate
  ) %>%
  pivot_longer(cols = -iso3c,
               names_to = "variavel",
               values_to = "valor") %>%
  filter(!is.na(valor)) %>%
  count(iso3c, variavel, name = "n_obs") %>%
  ggplot(aes(
    x = fct_reorder(iso3c, -n_obs, .fun = sum),
    y = n_obs,
    fill = variavel
  )) +
  geom_bar(stat = "identity",
           color = "white",
           width = 0.85) +
  scale_fill_manual(
    values = c(
      "#4DACD6",
      "#4FAE62",
      "#F6C54D",
      "#E37D46",
      "#C02D45",
      "#8ecae6",
      "#219ebc",
      "#023047",
      "#ffb703"
    ),
    name = "Vari√°vel"
  ) +
  labs(
    title = "Cobertura de Dados por Pa√≠s e Vari√°vel",
    subtitle = "N√∫mero de observa√ß√µes n√£o ausentes por pa√≠s e por vari√°vel",
    x = "Pa√≠s",
    y = "N¬∫ de Observa√ß√µes",
    caption = expression(bold("Fonte: ") ~ "WDI + CBIE + FMI")
  ) +
  theme_classic(base_size = 12) +
  theme(
    axis.text.x = element_text(
      angle = 60,
      hjust = 1,
      size = 9
    ),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    axis.text.y = element_text(size = 10),
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(
      size = 12,
      hjust = 0,
      margin = margin(b = 10)
    ),
    plot.caption = element_text(
      hjust = 0,
      size = 10,
      color = "black"
    ),
    legend.position = "left",
    legend.title = element_text(face = "bold"),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )

```

## üìä Gr√°fico da Infla√ß√£o Mundo

```{r grafico-inflacao-mundo, message=FALSE, warning=FALSE}

# world <- ne_countries(scale = "medium", returnclass = "sf") %>%
#   filter(name != "Antarctica") %>%
#   select(iso_a3, geometry)
# 
# grade_mapa <- expand_grid(iso_a3 = world$iso_a3, year = 2000:2023) %>%
#   left_join(world, by = "iso_a3") %>%
#   st_as_sf() %>%
#   left_join(data %>% filter(year >= 2000, year <= 2023),
#             by = c("iso_a3" = "iso3c", "year" = "year"))
# 
# paleta_inflacao <- scale_fill_viridis_c(
#   option = "plasma",
#   direction = -1,
#   name = "Infla√ß√£o (%)",
#   limits = c(-10, 100),
#   breaks = c(-10, 0, 5, 10, 25, 50, 100),
#   oob = squish,
#   na.value = "white"
# )
# 
# p <- ggplot(grade_mapa) +
#   geom_sf(aes(fill = inflation),
#           color = "grey40",
#           size = 0.2) +
#   paleta_inflacao +
#   coord_sf(expand = FALSE) +
#   labs(title = "Infla√ß√£o Global por Pa√≠s",
#        subtitle = "Varia√ß√£o percentual anual ‚Äî Ano: {current_frame}",
#        caption = "Fonte: WDI + Natural Earth") +
#   theme_void(base_size = 11) +
#   theme(
#     plot.title    = element_text(face = "bold", size = 18, hjust = 0),
#     plot.subtitle = element_text(
#       size = 13,
#       hjust = 0,
#       margin = margin(b = 10)
#     ),
#     plot.caption  = element_text(
#       size = 10,
#       hjust = 0,
#       color = "black",
#       margin = margin(t = 10)
#     ),
#     legend.position = "right",
#     legend.title = element_text(face = "bold", size = 11),
#     legend.text  = element_text(size = 9),
#     plot.title.position = "plot",
#     plot.caption.position = "plot",
#     plot.margin = margin(
#       t = 60,
#       r = 20,
#       b = 40,
#       l = 20
#     )
#   ) +
#   transition_manual(year)
# 
# anim_save(
#   "mapa_inflacao.gif",
#   animation = animate(
#     p,
#     fps = 2,
#     width = 1600,
#     height = 1000,
#     res = 150,
#     renderer = gifski_renderer()
#   )
# )
# 
# p
```

```{r incluir-mapa-inflacao, echo=FALSE, out.width="100%", fig.align='center'}
knitr::include_graphics("mapa_inflacao.gif")

```

## üìä Gr√°fico da Evolu√ß√£o do CBI

```{r grafico-cbi, message=FALSE, warning=FALSE}

ggplot() +
  geom_ribbon(
    data = data %>%
      group_by(year) %>%
      summarise(
        mean_cbie = mean(cbie_index, na.rm = TRUE),
        sd_cbie   = sd(cbie_index, na.rm = TRUE)
      ),
    aes(
      x = year,
      ymin = mean_cbie - sd_cbie,
      ymax = mean_cbie + sd_cbie
    ),
    fill = "#2A9D8F",
    alpha = 0.2
  ) +
  geom_line(
    data = data %>%
      group_by(year) %>%
      summarise(mean_cbie = mean(cbie_index, na.rm = TRUE)),
    aes(x = year, y = mean_cbie),
    color = "#1F4E79",
    size = 1
  ) +
  geom_line(
    data = data %>%
      group_by(year) %>%
      summarise(
        mean_cbie = mean(cbie_index, na.rm = TRUE),
        sd_cbie   = sd(cbie_index, na.rm = TRUE)
      ),
    aes(x = year, y = mean_cbie + sd_cbie),
    color = "#81B1D6",
    linetype = "dotted",
    size = 0.8
  ) +
  geom_line(
    data = data %>%
      group_by(year) %>%
      summarise(
        mean_cbie = mean(cbie_index, na.rm = TRUE),
        sd_cbie   = sd(cbie_index, na.rm = TRUE)
      ),
    aes(x = year, y = mean_cbie - sd_cbie),
    color = "#81B1D6",
    linetype = "dotted",
    size = 0.8
  ) +
  geom_point(
    data = data %>%
      group_by(year) %>%
      mutate(
        mean_cbie   = mean(cbie_index, na.rm = TRUE),
        sd_cbie     = sd(cbie_index, na.rm = TRUE),
        distance_up = cbie_index - (mean_cbie + sd_cbie)
      ) %>%
      filter(cbie_index > mean_cbie + sd_cbie) %>%
      slice_max(distance_up, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = cbie_index),
    color = "darkgreen",
    size = 3
  ) +
  geom_text(
    data = data %>%
      group_by(year) %>%
      mutate(
        mean_cbie   = mean(cbie_index, na.rm = TRUE),
        sd_cbie     = sd(cbie_index, na.rm = TRUE),
        distance_up = cbie_index - (mean_cbie + sd_cbie)
      ) %>%
      filter(cbie_index > mean_cbie + sd_cbie) %>%
      slice_max(distance_up, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = cbie_index, label = iso3c),
    color = "darkgreen",
    vjust = -0.8,
    size = 3
  ) +
  geom_point(
    data = data %>%
      group_by(year) %>%
      mutate(
        mean_cbie     = mean(cbie_index, na.rm = TRUE),
        sd_cbie       = sd(cbie_index, na.rm = TRUE),
        distance_down = (mean_cbie - sd_cbie) - cbie_index
      ) %>%
      filter(cbie_index < mean_cbie - sd_cbie) %>%
      slice_max(distance_down, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = cbie_index),
    color = "red",
    size = 3
  ) +
  geom_text(
    data = data %>%
      group_by(year) %>%
      mutate(
        mean_cbie     = mean(cbie_index, na.rm = TRUE),
        sd_cbie       = sd(cbie_index, na.rm = TRUE),
        distance_down = (mean_cbie - sd_cbie) - cbie_index
      ) %>%
      filter(cbie_index < mean_cbie - sd_cbie) %>%
      slice_max(distance_down, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = cbie_index, label = iso3c),
    color = "red",
    vjust = 1.5,
    size = 3
  ) +
  scale_x_continuous(breaks = sort(unique(data$year)), expand = expansion(mult = c(0.01, 0.01))) +
  scale_y_continuous(
    limits = c(0, 1),
    breaks = seq(0, 1, 0.2),
    expand = expansion(mult = c(0, 0))
  ) +
  labs(
    title    = "Evolu√ß√£o Anual do CBI",
    subtitle = "Linhas pontilhadas de 1 desvio-padr√£o, com os outliers",
    x        = "Ano",
    y        = "√çndice de Independ√™ncia do BC (CBI)",
    caption  = expression(bold("Fonte: ") ~ "https://cbidata.org/")
  ) +
  theme(
    plot.background    = element_rect(fill = "white", color = NA),
    panel.background   = element_rect(fill = "white", color = NA),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor   = element_blank(),
    axis.line.x.bottom = element_line(color = "black"),
    axis.line.y.left   = element_line(color = "black"),
    axis.ticks         = element_line(color = "black"),
    plot.title         = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle      = element_text(
      size = 12,
      hjust = 0,
      margin = margin(b = 10)
    ),
    axis.title         = element_text(face = "bold", size = 12),
    axis.text          = element_text(size = 10, color = "black"),
    plot.caption       = element_text(
      hjust = 0,
      size = 10,
      color = "black"
    ),
    plot.margin        = margin(15, 25, 15, 25)
  )

```

## üìä Gr√°fico da Infla√ß√£o anual

```{r grafico-inflacao-anual, message=FALSE, warning=FALSE}

ggplot() +
  geom_ribbon(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      summarise(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE)
      ),
    aes(
      x = year,
      ymin = mean_inflation - sd_inflation,
      ymax = mean_inflation + sd_inflation
    ),
    fill = "#2A9D8F",
    alpha = 0.2
  ) +
  geom_line(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      summarise(mean_inflation = mean(inflation, na.rm = TRUE)),
    aes(x = year, y = mean_inflation),
    color = "#1F4E79",
    size = 1
  ) +
  geom_line(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      summarise(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE)
      ),
    aes(x = year, y = mean_inflation + sd_inflation),
    color = "#81B1D6",
    linetype = "dotted",
    size = 0.8
  ) +
  geom_line(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      summarise(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE)
      ),
    aes(x = year, y = mean_inflation - sd_inflation),
    color = "#81B1D6",
    linetype = "dotted",
    size = 0.8
  ) +
  geom_point(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_up = inflation - (mean_inflation + sd_inflation)
      ) %>%
      filter(inflation > mean_inflation + sd_inflation) %>%
      slice_max(distance_up, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation),
    color = "darkgreen",
    size = 3
  ) +
  geom_text(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_up = inflation - (mean_inflation + sd_inflation)
      ) %>%
      filter(inflation > mean_inflation + sd_inflation) %>%
      slice_max(distance_up, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation, label = iso3c),
    color = "darkgreen",
    vjust = -0.8,
    size = 3
  ) +
  geom_point(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_down = (mean_inflation - sd_inflation) - inflation
      ) %>%
      filter(inflation < mean_inflation - sd_inflation) %>%
      slice_max(distance_down, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation),
    color = "red",
    size = 3
  ) +
  geom_text(
    data = data %>%
      filter(year > 2000) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_down = (mean_inflation - sd_inflation) - inflation
      ) %>%
      filter(inflation < mean_inflation - sd_inflation) %>%
      slice_max(distance_down, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation, label = iso3c),
    color = "red",
    vjust = 1.5,
    size = 3
  ) +
  scale_x_continuous(
    breaks = sort(unique(data %>% filter(year > 2000) %>% pull(year))),
    expand = expansion(mult = c(0.01, 0.01))
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0.02, 0.1))
  ) +
  labs(
    title    = "Evolu√ß√£o Anual da Infla√ß√£o",
    subtitle = "Linhas pontilhadas de 1 desvio-padr√£o, com os outliers",
    x        = "Ano",
    y        = "Infla√ß√£o (%)",
    caption  = expression(bold("Fonte: ") ~ "https://data.worldbank.org/indicator/FP.CPI.TOTL.ZG")
  ) +
  theme(
    plot.background    = element_rect(fill = "white", color = NA),
    panel.background   = element_rect(fill = "white", color = NA),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor   = element_blank(),
    axis.line.x.bottom = element_line(color = "black"),
    axis.line.y.left   = element_line(color = "black"),
    axis.ticks         = element_line(color = "black"),
    plot.title         = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle      = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    axis.title         = element_text(face = "bold", size = 12),
    axis.text          = element_text(size = 10, color = "black"),
    plot.caption       = element_text(hjust = 0, size = 10, color = "black"),
    plot.margin        = margin(15, 25, 15, 25)
  )
```

## üìä Gr√°fico da Infla√ß√£o anual (2000-Hoje; Pa√≠ses com Metas de infla√ß√£o)

```{r grafico-inflacao-anual-meta, message=FALSE, warning=FALSE}

ggplot() +
  geom_ribbon(
    data = data %>%
      filter(
        year > 2000,
        country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))
      ) %>%
      group_by(year) %>%
      summarise(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        .groups = "drop"
      ),
    aes(
      x = year,
      ymin = mean_inflation - sd_inflation,
      ymax = mean_inflation + sd_inflation
    ),
    fill = "#2A9D8F", alpha = 0.2
  ) +
  geom_line(
    data = data %>%
      filter(
        year > 2000,
        country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))
      ) %>%
      group_by(year) %>%
      summarise(mean_inflation = mean(inflation, na.rm = TRUE), .groups = "drop"),
    aes(x = year, y = mean_inflation),
    color = "#1F4E79", size = 1
  ) +
  geom_point(
    data = data %>%
      filter(
        year > 2000,
        country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))
      ) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_up    = inflation - (mean_inflation + sd_inflation)
      ) %>%
      filter(inflation > mean_inflation + sd_inflation) %>%
      slice_max(distance_up, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation),
    color = "darkgreen", size = 3
  ) +
  geom_text(
    data = data %>%
      filter(
        year > 2000,
        country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))
      ) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_up    = inflation - (mean_inflation + sd_inflation)
      ) %>%
      filter(inflation > mean_inflation + sd_inflation) %>%
      slice_max(distance_up, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation, label = iso3c),
    color = "darkgreen", vjust = -0.8, size = 3
  ) +
  geom_point(
    data = data %>%
      filter(
        year > 2000,
        country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))
      ) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_down  = (mean_inflation - sd_inflation) - inflation
      ) %>%
      filter(inflation < mean_inflation - sd_inflation) %>%
      slice_max(distance_down, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation),
    color = "red", size = 3
  ) +
  geom_text(
    data = data %>%
      filter(
        year > 2000,
        country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))
      ) %>%
      group_by(year) %>%
      mutate(
        mean_inflation = mean(inflation, na.rm = TRUE),
        sd_inflation   = sd(inflation, na.rm = TRUE),
        distance_down  = (mean_inflation - sd_inflation) - inflation
      ) %>%
      filter(inflation < mean_inflation - sd_inflation) %>%
      slice_max(distance_down, with_ties = FALSE) %>%
      ungroup(),
    aes(x = year, y = inflation, label = iso3c),
    color = "red", vjust = 1.5, size = 3
  ) +
  scale_x_continuous(
    breaks = sort(unique(data %>%
                           filter(year > 2000, country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais))) %>%
                           pull(year))),
    expand = expansion(mult = c(0.01, 0.01))
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0.02, 0.1))
  ) +
  labs(
    title    = "Infla√ß√£o M√©dia Anual ‚Äî Pa√≠ses com Metas de Infla√ß√£o",
    subtitle = "Desvio padr√£o e destaques para outliers acima/abaixo",
    x        = "Ano",
    y        = "Infla√ß√£o (%)",
    caption  = expression(bold("Fonte: ") ~ "WDI + CBIE + Target Framework")
  ) +
  theme(
    plot.background    = element_rect(fill = "white", color = NA),
    panel.background   = element_rect(fill = "white", color = NA),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor   = element_blank(),
    axis.line.x.bottom = element_line(color = "black"),
    axis.line.y.left   = element_line(color = "black"),
    axis.ticks         = element_line(color = "black"),
    plot.title         = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle      = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    axis.title         = element_text(face = "bold", size = 12),
    axis.text          = element_text(size = 10, color = "black"),
    plot.caption       = element_text(hjust = 0, size = 10, color = "black"),
    plot.margin        = margin(15, 25, 15, 25)
  )
```

## üìä Gr√°fico do PIB de Acordo com as Classifica√ß√µes do Acemoglu

### üìä Gr√°fico do PIB Pa√≠ses High

```{r grafico-pib-high, message=FALSE, warning=FALSE}

data %>%
  left_join(acemoglu_classification, by = c("country" = "Pais")) %>%
  filter(Classe == "High", !is.na(pib)) %>%
  group_by(year, country) %>%
  summarise(pib_total = sum(pib, na.rm = TRUE), .groups = "drop") %>%
  mutate(country = fct_reorder(country, pib_total, .fun = sum)) %>%
  ggplot(aes(x = year, y = pib_total, fill = country)) +
  geom_area(color = "white",
            size = 0.1,
            alpha = 0.95) +
  scale_fill_manual(
    values = c(
      "#4DACD6",
      "#4FAE62",
      "#F6C54D",
      "#E37D46",
      "#C02D45",
      "#8ecae6",
      "#219ebc",
      "#023047",
      "#ffb703",
      "#72A1DB"
    )
  ) +
  scale_y_continuous(labels = label_number(scale_cut = cut_short_scale())) +
  labs(
    title = "PIB Agregado dos Pa√≠ses com Institui√ß√µes 'High'",
    subtitle = "Evolu√ß√£o do PIB (USD correntes) ‚Äî 2000 a 2025",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Classifica√ß√£o Acemoglu"),
    x = NULL,
    y = NULL
  ) +
  theme_classic(base_size = 12) +
  theme(
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(
      size = 12,
      hjust = 0,
      margin = margin(b = 10)
    ),
    plot.caption = element_text(
      hjust = 0,
      size = 10,
      color = "black"
    ),
    legend.position = "top",
    legend.title = element_blank(),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

### üìä Gr√°fico do PIB Pa√≠ses Medium

```{r grafico-pib-medium, message=FALSE, warning=FALSE}

data %>%
  left_join(acemoglu_classification, by = c("country" = "Pais")) %>%
  filter(Classe == "Medium", !is.na(pib)) %>%
  group_by(year, country) %>%
  summarise(pib_total = sum(pib, na.rm = TRUE), .groups = "drop") %>%
  mutate(country = fct_reorder(country, pib_total, .fun = sum)) %>%
  ggplot(aes(x = year, y = pib_total, fill = country)) +
  geom_area(color = "white",
            size = 0.1,
            alpha = 0.95) +
  scale_fill_manual(
    values = c(
      "#4DACD6",
      "#4FAE62",
      "#F6C54D",
      "#E37D46",
      "#C02D45",
      "#8ecae6",
      "#219ebc",
      "#023047",
      "#ffb703",
      "#9b5de5",
      "#9F86C0",
      "#5E548E",
      "#2A9D8F",
      "#E76F51",
      "#264653",
      "#F8961E",
      "#43AA8B",
      "#F94144",
      "#90BE6D"
    )
  ) +
  scale_y_continuous(labels = label_number(scale_cut = cut_short_scale())) +
  labs(
    title = "PIB Agregado dos Pa√≠ses com Institui√ß√µes 'Medium'",
    subtitle = "Evolu√ß√£o do PIB (USD correntes) ‚Äî 2000 a 2025",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Classifica√ß√£o Acemoglu"),
    x = NULL,
    y = NULL
  ) +
  theme_classic(base_size = 12) +
  theme(
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(
      size = 12,
      hjust = 0,
      margin = margin(b = 10)
    ),
    plot.caption = element_text(
      hjust = 0,
      size = 10,
      color = "black"
    ),
    legend.position = "top",
    legend.title = element_blank(),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

### üìä Gr√°fico do PIB Pa√≠ses Low

```{r grafico-pib-low, message=FALSE, warning=FALSE}

data %>%
  left_join(acemoglu_classification, by = c("country" = "Pais")) %>%
  filter(Classe == "Low", !is.na(pib)) %>%
  group_by(year, country) %>%
  summarise(pib_total = sum(pib, na.rm = TRUE), .groups = "drop") %>%
  mutate(country = fct_reorder(country, pib_total, .fun = sum)) %>%
  ggplot(aes(x = year, y = pib_total, fill = country)) +
  geom_area(color = "white",
            size = 0.1,
            alpha = 0.95) +
  scale_fill_manual(
    values = c(
      "#4DACD6",
      "#4FAE62",
      "#F6C54D",
      "#E37D46",
      "#C02D45",
      "#8ecae6",
      "#219ebc",
      "#023047",
      "#ffb703",
      "#9b5de5"
    )
  ) +
  scale_y_continuous(labels = label_number(scale_cut = cut_short_scale())) +
  labs(
    title = "PIB Agregado dos Pa√≠ses com Institui√ß√µes 'Low'",
    subtitle = "Evolu√ß√£o do PIB (USD correntes) ‚Äî 2000 a 2025",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Classifica√ß√£o Acemoglu"),
    x = NULL,
    y = NULL
  ) +
  theme_classic(base_size = 12) +
  theme(
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
    axis.title.y = element_text(face = "bold", margin = margin(r = 10)),
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(
      size = 12,
      hjust = 0,
      margin = margin(b = 10)
    ),
    plot.caption = element_text(
      hjust = 0,
      size = 10,
      color = "black"
    ),
    legend.position = "top",
    legend.title = element_blank(),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

## üìä Gr√°fico da Resposta da Infla√ß√£o √† Taxa Real de Juros

### üìä Gr√°fico da Resposta da Infla√ß√£o √† Taxa Real de Juros High

```{r grafico-inflacao-juros-high, message=FALSE, warning=FALSE}

data %>%
  left_join(acemoglu_classification, by = c("country" = "Pais")) %>%
  group_by(country) %>%
  mutate(
    inflacao_a_frente = dplyr::lead(inflation, 1),
    delta_inflacao = inflacao_a_frente - inflation
  ) %>%
  ungroup() %>%
  filter(
    Classe == "High",
    !is.na(real_rate),
    !is.na(delta_inflacao),
    !is.na(cbie_index)
  ) %>%
  ggplot(aes(x = real_rate, y = delta_inflacao, color = cbie_index)) +
  geom_point(alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2) +
  scale_color_viridis_c(option = "plasma", name = "Independ√™ncia BC") +
  labs(
    title = "Classe 'High': Resposta da Infla√ß√£o √† Taxa Real",
    subtitle = "Œî Infla√ß√£o (t+1 - t) vs. Taxa Real de Juros",
    x = "Taxa Real de Juros (%)",
    y = "Œî Infla√ß√£o (%)",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Classifica√ß√£o Acemoglu")
  ) +
  theme_classic(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 0),
    legend.position = "bottom",
    legend.title = element_text(face = "bold"),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

### üìä Gr√°fico da Resposta da Infla√ß√£o √† Taxa Real de Juros Medium

```{r grafico-inflacao-juros-medium, message=FALSE, warning=FALSE}

data %>%
  left_join(acemoglu_classification, by = c("country" = "Pais")) %>%
  group_by(country) %>%
  mutate(
    inflacao_a_frente = dplyr::lead(inflation, 1),
    delta_inflacao = inflacao_a_frente - inflation
  ) %>%
  ungroup() %>%
  filter(
    Classe == "Medium",
    !is.na(real_rate),
    !is.na(delta_inflacao),
    !is.na(cbie_index)
  ) %>%
  ggplot(aes(x = real_rate, y = delta_inflacao, color = cbie_index)) +
  geom_point(alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2) +
  scale_color_viridis_c(option = "plasma", name = "Independ√™ncia BC") +
  labs(
    title = "Classe 'Medium': Resposta da Infla√ß√£o √† Taxa Real",
    subtitle = "Œî Infla√ß√£o (t+1 - t) vs. Taxa Real de Juros",
    x = "Taxa Real de Juros (%)",
    y = "Œî Infla√ß√£o (%)",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Classifica√ß√£o Acemoglu")
  ) +
  theme_classic(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 0),
    legend.position = "bottom",
    legend.title = element_text(face = "bold"),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

### üìä Gr√°fico da Resposta da Infla√ß√£o √† Taxa Real de Juros Low

```{r grafico-inflacao-juros-low, message=FALSE, warning=FALSE}

data %>%
  left_join(acemoglu_classification, by = c("country" = "Pais")) %>%
  group_by(country) %>%
  mutate(
    inflacao_a_frente = dplyr::lead(inflation, 1),
    delta_inflacao = inflacao_a_frente - inflation
  ) %>%
  ungroup() %>%
  filter(
    Classe == "Low",
    !is.na(real_rate),
    !is.na(delta_inflacao),
    !is.na(cbie_index)
  ) %>%
  ggplot(aes(x = real_rate, y = delta_inflacao, color = cbie_index)) +
  geom_point(alpha = 0.5, size = 2) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2) +
  scale_color_viridis_c(option = "plasma", name = "Independ√™ncia BC") +
  labs(
    title = "Classe 'Low': Resposta da Infla√ß√£o √† Taxa Real",
    subtitle = "Œî Infla√ß√£o (t+1 - t) vs. Taxa Real de Juros",
    x = "Taxa Real de Juros (%)",
    y = "Œî Infla√ß√£o (%)",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Classifica√ß√£o Acemoglu")
  ) +
  theme_classic(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 0),
    legend.position = "bottom",
    legend.title = element_text(face = "bold"),
    legend.text = element_text(size = 10),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

## üìä Gr√°fico da Infla√ß√£o contra a Infla√ß√£o Esperada (com ou sem regime de meta)

### üìä Gr√°fico da Infla√ß√£o contra a Infla√ß√£o Esperada no Regime de Metas

```{r grafico-inflacao-esperada-meta, message=FALSE, warning=FALSE}

data %>%
  left_join(target, by = c("country" = "Pais")) %>%
  filter(
    !is.na(AnoAdocao),
    SegueAtualmente == "sim",
    year >= AnoAdocao,
    !is.na(inflation),
    !is.na(inflation_forecast),
    inflation > 0,
    inflation_forecast > 0
  ) %>%
  ggplot(aes(x = inflation_forecast, y = inflation)) +
  geom_point(alpha = 0.5, size = 2, color = "#43aa8b") +
  geom_smooth(method = "lm", se = FALSE, color = "#005f73", linewidth = 1.2) +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "grey50") +
  labs(
    title = "Pa√≠ses que Seguem Regime de Metas",
    subtitle = "Infla√ß√£o Observada vs. Esperada",
    x = "Infla√ß√£o Esperada (%)",
    y = "Infla√ß√£o Observada (%)",
    caption = expression(bold("Fonte: ") ~ "WDI + FMI + Targeting Dataset")
  ) +
  theme_classic(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 0),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

### üìä Gr√°fico da Infla√ß√£o contra a Infla√ß√£o Esperada que sa√≠ram do Regime de Metas

```{r grafico-inflacao-esperada-sem-meta, message=FALSE, warning=FALSE}

data %>%
  left_join(target, by = c("country" = "Pais")) %>%
  filter(
    !is.na(AnoAdocao),
    SegueAtualmente != "sim",
    year >= AnoAdocao,
    !is.na(inflation),
    !is.na(inflation_forecast),
    inflation > 0,
    inflation_forecast > 0
  ) %>%
  ggplot(aes(x = inflation_forecast, y = inflation)) +
  geom_point(alpha = 0.5, size = 2, color = "#f9c74f") +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2, color = "#f9844a") +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "grey40") +
  labs(
    title = "Infla√ß√£o Esperada vs. Observada ‚Äî Pa√≠ses que Sa√≠ram do Regime",
    subtitle = "Apenas anos com regime ainda vigente √† √©poca",
    x = "Infla√ß√£o Esperada (%)",
    y = "Infla√ß√£o Observada (%)",
    caption = expression(bold("Fonte: ") ~ "WDI + Surveys + Targeting dataset")
  ) +
  theme_classic(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 0),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

### üìä Gr√°fico da Infla√ß√£o contra a Infla√ß√£o Esperada (sem regime de meta)

```{r grafico-inflacao-esperada-sem-meta-2, message=FALSE, warning=FALSE}

data %>%
  left_join(target, by = c("country" = "Pais")) %>%
  filter(
    is.na(AnoAdocao),
    !is.na(inflation),
    !is.na(inflation_forecast),
    inflation > 0,
    inflation_forecast > 0
  ) %>%
  ggplot(aes(x = inflation_forecast, y = inflation)) +
  geom_point(alpha = 0.5, size = 2, color = "#f94144") +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2, color = "#d1495b") +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "grey40") +
  labs(
    title = "Infla√ß√£o Esperada vs. Observada ‚Äî Pa√≠ses sem Regime de Metas",
    subtitle = "Inclui todos os anos dispon√≠veis",
    x = "Infla√ß√£o Esperada (%)",
    y = "Infla√ß√£o Observada (%)",
    caption = expression(bold("Fonte: ") ~ "WDI + Surveys")
  ) +
  theme_classic(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    plot.caption = element_text(size = 10, hjust = 0),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank()
  )
```

## üìä Gr√°fico da m√©dia do CBIE dados pa√≠ses que seguem ou n√£o as metas de infla√ß√£o

```{r grafico-cbie-meta, message=FALSE, warning=FALSE}

data %>%
  filter(
    year >= 2000,
    country %in% (target %>% pull(Pais))
  ) %>%
  mutate(grupo_target = if_else(
    country %in% (target %>% filter(SegueAtualmente == "sim") %>% pull(Pais)),
    "Segue metas", "N√£o segue"
  )) %>%
  group_by(year, grupo_target) %>%
  summarise(cbie_medio = mean(cbie_index, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = year, y = cbie_medio, color = grupo_target)) +
  geom_line(size = 1.2) +
  geom_point(size = 2.5) +
  scale_color_manual(values = c("Segue metas" = "#2A9D8F", "N√£o segue" = "#E76F51")) +
  labs(
    title = "Evolu√ß√£o do √çndice de Independ√™ncia do Banco Central",
    subtitle = "Compara√ß√£o entre pa√≠ses que seguem ou n√£o metas de infla√ß√£o",
    x = "Ano", y = "CBIE M√©dio", color = "Grupo",
    caption = expression(bold("Fonte: ") ~ "CBIE + Target Framework")
  ) +
  theme(
    plot.background    = element_rect(fill = "white", color = NA),
    panel.background   = element_rect(fill = "white", color = NA),
    panel.grid.major.y = element_line(color = "grey80"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor   = element_blank(),
    axis.line.x.bottom = element_line(color = "black"),
    axis.line.y.left   = element_line(color = "black"),
    axis.ticks         = element_line(color = "black"),
    plot.title         = element_text(face = "bold", size = 16, hjust = 0),
    plot.subtitle      = element_text(size = 12, hjust = 0, margin = margin(b = 10)),
    axis.title         = element_text(face = "bold", size = 12),
    axis.text          = element_text(size = 10, color = "black"),
    legend.title       = element_text(face = "bold"),
    legend.position    = "top",
    plot.caption       = element_text(hjust = 0, size = 10, color = "black"),
    plot.margin        = margin(15, 25, 15, 25)
  )

```

# üßÆ Estima√ß√£o do Modelo GMM

$$
\begin{aligned}
\text{infla√ß√£o}_{it} &= \alpha_1 \cdot \text{infla√ß√£o}_{it-1} + \alpha_2 \cdot \text{real\_rate}_{it} + \alpha_3 \cdot \text{cbie\_index}_{it} \\
&\quad + \alpha_4 \cdot \text{hiato}_{it} + \alpha_5 \cdot (\text{real\_rate}_{it} \times \text{cbie\_index}_{it}) \\
&\quad + \alpha_6 \cdot \text{inflation\_forecast}_{it} + \mu_i + \nu_{it}
\end{aligned}
$$

## üìä Preprando os dados para o GMM

```{r gmm-preparacao, message=FALSE, warning=FALSE}

painel <- pdata.frame(data, index = c("country", "year"))

```

## üìä Estimando o modelo GMM

```{r gmm-estimacao, message=FALSE, warning=FALSE}

modelo_gmm <- pgmm(
  formula = inflation ~ lag(inflation, 1) + real_rate * cbie_index + hiato_pct + inflation_forecast
  | lag(inflation, 2:3) + lag(real_rate, 2:3) + lag(inflation_forecast, 2:3) + cbie_index + hiato_pct,
  data           = painel,
  effect         = "individual",
  model          = "twosteps",
  transformation = "d"
)

```

### üìä Resumo do modelo GMM

```{r gmm-resumo, message=FALSE, warning=FALSE, results='asis'}

# Resumo e estrutura do painel
sm          <- summary(modelo_gmm)
pdim        <- plm::pdim(modelo_gmm)
n_obs       <- pdim$N
n_countries <- pdim$n

# Testes de diagn√≥stico
tests  <- sm$tests
sargan <- tests$Sargan
ar1    <- tests$AR1
ar2    <- tests$AR2
wald   <- tests$Wald

# T√≠tulo + subt√≠tulo manual
cat(
  "<h3 style='text-align:center;'>Estimativas do Modelo GMM com Expectativas de Infla√ß√£o</h3>\n",
  "<h4 style='text-align:center;font-weight:normal;'>Painel desbalanceado (77 pa√≠ses, 1.316 obs.), two‚Äëstep Difference GMM</h4>\n"
)

# Tabela em HTML com stargazer
stargazer(
  modelo_gmm,
  type = "html",
  header = FALSE,
  summary = FALSE,
  dep.var.labels.include = FALSE,
  covariate.labels = c(
    "$\\alpha_1$ (Infla√ß√£o defasada)",
    "$\\alpha_2$ (Juros real)",
    "$\\alpha_3$ (Indep. BC)",
    "$\\alpha_4$ (Hiato do produto)",
    "$\\alpha_5$ (Intera√ß√£o juros $\\times$ independ√™ncia)",
    "$\\alpha_6$ (Expectativa de infla√ß√£o)"
  ),
  digits = 4,
  star.cutoffs = c(0.05, 0.001),
  star.char = c("*", "***"),
  no.space = TRUE,
  add.lines = list(
    c("N¬∫ de observa√ß√µes", as.character(n_obs)),
    c("N¬∫ de pa√≠ses (painel desbalanceado)", as.character(n_countries)),
    c("Teste de Sargan (overid)",
      sprintf("$\\chi^2(%d)=%.2f$, $p$‚Äëvalue=%.3f$",
              sargan$df, sargan$statistic, sargan$p.value)),
    c("AR(1) (Arellano‚ÄëBond)",
      sprintf("$z=%.2f$, $p$‚Äëvalue=%.4f$",
              ar1$statistic, ar1$p.value)),
    c("AR(2) (Arellano‚ÄëBond)",
      sprintf("$z=%.2f$, $p$‚Äëvalue=%.3f$",
              ar2$statistic, ar2$p.value)),
    c("Wald (conj. de coeficientes)",
      sprintf("$\\chi^2(%d)=%.2f$, $p$‚Äëvalue<%.3f$",
              wald$df, wald$statistic, wald$p.value))
  ),
  notes = c("* p<0.05; *** p<0.001"),
  notes.align = "l"
)
```

### üìä Estimando o modelo GMM para as classes de Acemoglu

####  Preprando os dados para avaliar as classes

```{r gmm-preparacao-classes, message=FALSE, warning=FALSE}

painel <- left_join(painel, acemoglu_classification, by = c("country" = "Pais"))

```

#### üìä Estimando o modelo GMM para a classe High

```{r gmm-estimacao-high, message=FALSE, warning=FALSE}

gmm_high <- pgmm(
  formula = inflation ~ lag(inflation, 1) + real_rate * cbie_index + hiato_pct + inflation_forecast
  | lag(inflation, 2:3) + lag(real_rate, 2:3) + lag(inflation_forecast, 2:3) + cbie_index + hiato_pct,
  data = subset(painel, Classe == "High"),
  effect = "individual",
  model = "twosteps",
  transformation = "d"
)

```

##### üìä Resumo do modelo GMM para a classe High

```{r gmm-resumo-high, message=FALSE, warning=FALSE}

coefs_gmm_high <- summary(gmm_high, robust = TRUE)$coefficients

as.data.frame(coefs_gmm_high) %>% rownames_to_column("Vari√°vel") %>% rename(
  `Estimativa` = Estimate,
  `Erro Padr√£o` = `Std. Error`,
  `Estat√≠stica z` = `z-value`,
  `p-valor` = `Pr(>|z|)`
) %>% mutate(
  Signif = case_when(
    `p-valor` <= 0.001 ~ "***",
    `p-valor` <= 0.01 ~ "**",
    `p-valor` <= 0.05 ~ "*",
    `p-valor` <= 0.1 ~ ".",
    TRUE ~ ""
  )
) %>% gt() %>% tab_header(
  title = md("**Estimativas do Modelo GMM ‚Äî Classe High**"),
  subtitle = "Modelo com efeitos individuais e diferencia√ß√£o em primeiras diferen√ßas"
) %>% fmt_number(columns = where(is.numeric), decimals = 3) %>% cols_label(
  Vari√°vel = "Vari√°vel",
  `Estimativa` = "Coef.",
  `Erro Padr√£o` = "Erro Padr√£o",
  `Estat√≠stica z` = "z-valor",
  `p-valor` = "p-valor",
  Signif = " "
) %>% tab_source_note(md("*Nota: `***` 0.1% | `**` 1% | `*` 5% | `.` 10%*"))

```

#### üìä Estimando o modelo GMM para a classe Medium

```{r gmm-estimacao-medium, message=FALSE, warning=FALSE}

gmm_medium <- pgmm(
  formula = inflation ~ lag(inflation, 1) + real_rate * cbie_index + hiato_pct + inflation_forecast
  | lag(inflation, 2:3) + lag(real_rate, 2:3) + lag(inflation_forecast, 2:3) + cbie_index + hiato_pct,
  data = subset(painel, Classe == "Medium"),
  effect = "individual",
  model = "twosteps",
  transformation = "d"
)

```


##### üìä Resumo do modelo GMM para a classe Medium

```{r gmm-resumo-medium, message=FALSE, warning=FALSE}

coefs_gmm_medium <- summary(gmm_medium, robust = TRUE)$coefficients

as.data.frame(coefs_gmm_medium) %>% rownames_to_column("Vari√°vel") %>% rename(
  `Estimativa` = Estimate,
  `Erro Padr√£o` = `Std. Error`,
  `Estat√≠stica z` = `z-value`,
  `p-valor` = `Pr(>|z|)`
) %>% mutate(
  Signif = case_when(
    `p-valor` <= 0.001 ~ "***",
    `p-valor` <= 0.01 ~ "**",
    `p-valor` <= 0.05 ~ "*",
    `p-valor` <= 0.1 ~ ".",
    TRUE ~ ""
  )
) %>% gt() %>% tab_header(
  title = md("**Estimativas do Modelo GMM ‚Äî Classe Medium**"),
  subtitle = "Modelo com efeitos individuais e diferencia√ß√£o em primeiras diferen√ßas"
) %>% fmt_number(columns = where(is.numeric), decimals = 3) %>% cols_label(
  Vari√°vel = "Vari√°vel",
  `Estimativa` = "Coef.",
  `Erro Padr√£o` = "Erro Padr√£o",
  `Estat√≠stica z` = "z-valor",
  `p-valor` = "p-valor",
  Signif = " "
) %>% tab_source_note(md("*Nota: `***` 0.1% | `**` 1% | `*` 5% | `.` 10%*"))

```

#### üìä Estimando o modelo Efeitos Fixoa para a classe Low

```{r fixest-estimacao-low, message=FALSE, warning=FALSE}

modelo_low_fe <- fixest::feols(
  inflation ~ lag(inflation, 1) + real_rate * cbie_index + hiato_pct + inflation_forecast | country + year,
  data = subset(painel, Classe == "Low"),
  cluster = "country"
)

```

##### üìä Resumo do modelo Efeito Fixo para a classe Low

```{r fixest-resumo-low, message=FALSE, warning=FALSE}

summary(modelo_low_fe)

```
